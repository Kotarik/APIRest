'use strict';
var mongoose = require('mongoose'),
 Auteur = mongoose.model('Auteur'),
 Film = mongoose.model('Film'),
 Commentaire = mongoose.model('Commentaire');
var mongo = require('./mongo.js');
var url = "mongodb://localhost:3000/";
var MongoClient = require('mongodb').MongoClient;

var host = process.env.MONGODB_ADDON_HOST;
var uri = process.env.MONGODB_ADDON_URI;
var pwd = process.env.MONGODB_ADDON_PASSWORD;
var user = process.env.MONGODB_ADDON_USER;
var db = process.env.MONGODB_ADDON_DB;
var port = process.env.MONGODB_ADDON_PORT;




	module.exports = {
/**	
		list_all_film: function(req, res) {
		  film.find({}, function(err, film) {
			if (err)
			  res.send(err);
			res.json(film);
		  });
		},
**/
		create_a_film: function(req, res) 
		{
			MongoClient.connect(url, function(err, res) {
				if (err) throw err;
				var dbo = res.db("API");
				var tmp = {film: req.params.film, auteur: req.params.auteur, id: req.params.id};
				dbo.collection("films").insertOne(tmp, function(err, res){
					if (err)
						res.send(err);
					res.json({ message: 'film créé '} + tmp);
					db.close();
				});
			});
		},
	};


/**
MongoClient.connect(url, function(err, res) {
	if (err) throw err;
	var dbo = res.db("API");

	exports.list_all_film = function(req, res) {
	  film.find({}, function(err, film) {
		if (err)
		  res.send(err);
		res.json(film);
	  });
	};


	exports.create_a_film = function(req, res) 
	{
	//  film exist?
	//	if(!findFilm(req.params.film))
	//	{
			var tmp = {film: req.params.film, auteur: req.params.auteur, id: req.params.id};
			dbo.collection("films").insertOne(tmp, function(err, res){
				if (err)
					res.send(err);
				res.json({ message: 'film créé '} + tmp);
				db.close();
			});
					
	//	} 
	//	else
	//	{
	//		res.status(400);
	//		res.send({message:'film existe deja'});
	//	}

		//  var new_film = new film(req.body);
		//  new_film.save(function(err, film) {
		//    if (err)
		//      res.send(err);
		//    res.json({ message: 'film créé : '} + film);
		//  });
	};


	exports.read_a_film = function(req, res) {
	  film.findById(req.params.filmId, function(err, film) {
		if (err)
		  res.send(err);
		res.json(film);
	  });
	};


	exports.update_a_film = function(req, res) {
	  film.findOneAndUpdate({_id: req.params.filmId}, req.body, {new: true}, function(err, film) {
		if (err)
		  res.send(err);
		res.json({ message: 'Film mis à jour : ' } + film);
	  });
	};


	exports.delete_a_film = function(req, res) {
	  film.remove({
		_id: req.params.filmId
	  }, function(err, film) {
		if (err)
		  res.send(err);
		res.json({ message: 'film supprimé avec succès' });
	  });
	};

	exports.list_a_commentaire = function(req, res) {
	  commentaire.find({}, function(err, commentaire) {
		if (err)
		  res.send(err);
		res.json(commentaire);
	  });
	};


	exports.create_a_commentaire = function(req, res) {
	  var new_commentaire = new commentaire(req.body);
	  new_commentaire.save(function(err, commentaire) {
		if (err)
		  res.send(err);
		res.json({ message: 'Commentaire créé : ' } + commentaire);
	  });
	};

	exports.connection = function(req, res) {
	  var connect = new connexion(req.body);
	  connect.save(function(err, connexion) {
		if (err)
		  res.send(err);
		res.json(connexion);
	  });
	};
});
**/